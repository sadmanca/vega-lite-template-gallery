---
// VegaLite.astro
import { readFile } from 'fs/promises';
import { resolve } from 'path';

const { filePath } = Astro.props; // Path to the JSON file under the /public directory

let templateContent = '';
let jsonData = '';

try {
  // Read the template.html file
  const templatePath = resolve('public/template.html');
  templateContent = await readFile(templatePath, 'utf-8');

  // Read the JSON file
  const jsonPath = resolve('public', filePath);
  const fileContent = await readFile(jsonPath, 'utf-8');
  jsonData = JSON.stringify(JSON.parse(fileContent), null, 2);

  // Inject JSON data into the <pre> tag
  templateContent = templateContent.replace(
    '<pre id="vega-lite-spec" class="vega-lite" contenteditable="false" data-mce-highlighted="false">',
    `<pre id="vega-lite-spec" class="vega-lite" contenteditable="false" data-mce-highlighted="false">${jsonData}`
  );
} catch (error) {
  console.error('Error reading files:', error);
}
---

<div set:html={templateContent}></div>